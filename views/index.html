<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no" />
<title>程序</title>
<link href="./antd.5e8657b5447d6dac525b.css" rel="stylesheet"><link href="./app.79bd1d25947a05bbc636.css" rel="stylesheet"></head>
<style>
    html {
        font-size: 26.66667vw;
        max-width: 640px;
        margin: 0 auto;
    }
    @media only screen and (min-width: 640px) {
        html {
            font-size: 170.66667px;
        }
    }
</style>
<!-- <script crossorigin src="https://unpkg.com/react@16/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.production.min.js"></script> -->
<body>
    <div id='main'></div>
<script type="text/javascript" src="./antd.9bf7f5063bb3b585f822.js"></script><script type="text/javascript" src="./common.324d502efeba02640cf9.js"></script><script>!function(e){function t(t){for(var r,a,o=t[0],c=t[1],u=t[2],l=0,f=[];l<o.length;l++)a=o[l],i[a]&&f.push(i[a][0]),i[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);for(m&&m(t);f.length;)f.shift()();return s.push.apply(s,u||[]),n()}function n(){for(var e,t=0;t<s.length;t++){for(var n=s[t],r=!0,a=1;a<n.length;a++){var c=n[a];0!==i[c]&&(r=!1)}r&&(s.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},a={1:0},i={1:0},s=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.e=function(e){var t=[];a[e]?t.push(a[e]):0!==a[e]&&{3:1}[e]&&t.push(a[e]=new Promise(function(t,n){for(var r=({}[e]||e)+"."+{3:"61e726d570a612a96e6f"}[e]+".css",i=o.p+r,s=document.getElementsByTagName("link"),c=0;c<s.length;c++){var u=(m=s[c]).getAttribute("data-href")||m.getAttribute("href");if("stylesheet"===m.rel&&(u===r||u===i))return t()}var l=document.getElementsByTagName("style");for(c=0;c<l.length;c++){var m;if((u=(m=l[c]).getAttribute("data-href"))===r||u===i)return t()}var f=document.createElement("link");f.rel="stylesheet",f.type="text/css",f.onload=t,f.onerror=function(t){var r=t&&t.target&&t.target.src||i,s=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");s.request=r,delete a[e],f.parentNode.removeChild(f),n(s)},f.href=i,document.getElementsByTagName("head")[0].appendChild(f)}).then(function(){a[e]=0}));var n=i[e];if(0!==n)if(n)t.push(n[2]);else{var r=new Promise(function(t,r){n=i[e]=[t,r]});t.push(n[2]=r);var s,c=document.createElement("script");c.charset="utf-8",c.timeout=120,o.nc&&c.setAttribute("nonce",o.nc),c.src=function(e){return o.p+""+({}[e]||e)+"."+{3:"b5e9dc4ef981c0b38b01"}[e]+".js"}(e),s=function(t){c.onerror=c.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src,s=new Error("Loading chunk "+e+" failed.\n("+r+": "+a+")");s.type=r,s.request=a,n[1](s)}i[e]=void 0}};var u=setTimeout(function(){s({type:"timeout",target:c})},12e4);c.onerror=c.onload=s,document.head.appendChild(c)}return Promise.all(t)},o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="./",o.oe=function(e){throw console.error(e),e};var c=window.webpackJsonp=window.webpackJsonp||[],u=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var m=u;s.push([227,0,2]),n()}({143:function(e,t,n){e.exports={topBar:"index__topBar--ff27q",back:"index__back--1t2C-"}},227:function(e,t,n){e.exports=n(471)},259:function(e,t){},262:function(e,t,n){},32:function(e,t,n){e.exports={mewrapper:"index__mewrapper--1H0UM",topBar:"index__topBar--1p5HF",back:"index__back--1bgCc",save:"index__save--2XWb_",changeItem:"index__changeItem--2aN2i",chPassword:"index__chPassword--1iiG4",saveHighlight:"index__saveHighlight--22jC1",spanAdd:"index__spanAdd--ghCAc",logOut:"index__logOut--3Ee36"}},322:function(e,t,n){},323:function(e,t,n){},454:function(e,t,n){},455:function(e,t,n){},464:function(e,t,n){},465:function(e,t,n){},471:function(e,t,n){"use strict";n.r(t);var r=n(7),a=n.n(r),i=n(17),s=n.n(i),o=n(0),c=n.n(o),u=n(8),l=n.n(u),m=n(10),f=n.n(m),d=n(12),p=n.n(d),h=n(14),g=n.n(h),b=n(15),v=n.n(b),w=n(16),y=n.n(w),k=n(9),N=(n(53),n(21)),E=n.n(N),I=n(4),x=n.n(I),O=n(208),j=n.n(O),C=n(1),_=(n(262),n(5)),P=n.n(_),L=n(6),A=n.n(L),M=(n(46),n(25)),F=new(function(){function e(){f()(this,e),this.apiDomain=""}return p()(e,[{key:"get",value:function(e){var t=window.location.protocol+"//tangshisanbaishou.xyz/api/",n={animal:{api:t+"123",nickName:"动物接口测试"},searchName:{api:t+"searchName"},addChatUser:{api:t+"addChatUser"},chatVerify:{api:t+"chatVerify"},addFriend:{api:t+"addFriend"},userInfo:{api:t+"userInfo"},agreeFriendReq:{api:t+"agreeFriendReq"},getAllMessage:{api:t+"getAllMessage"},getMoreMessage:{api:t+"getMoreMessage"},updateUserInfo:{api:t+"updateUserInfo"}};return n[e]&&n[e].api}}]),e}()),S=function(e,t){return 0===e.indexOf(t)};function R(e,t){var n=function(e){return e.split("").reverse().join("")},r=n(e),a=r.indexOf(n(t));return-1!==a?n(r.slice(0,a)):""}function U(e){return e?"url("+e+")":""}var z,T,D,q,B,H,V={get:function(e,t,n){return M.netModel.get(F.get(e),Object.assign(t,{userName:window.chatUserName},n))},post:function(e,t,n){return M.netModel.post(F.get(e),Object.assign(t,{userName:window.chatUserName},n))}},W=function(e,t){return-1!==e.findIndex(function(e){return e.userName===t.userName})};function J(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map(function(e){return"".concat(e)}).join(" ")}var K=(z=C.c.bound,T=C.c.bound,D=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return n=g()(this,(e=v()(t)).call.apply(e,[this].concat(a))),P()(n,"changeInput",q,x()(n)),P()(n,"initMessage",B,x()(n)),P()(n,"changePage",H,x()(n)),n.createMessage=function(e,t){return{content:t,owner:e,timeStamp:(new Date).valueOf()}},n.updateMesRank=function(){(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])&&n.store.socketIoObj.emit("updateMessRank",n.store.userName,n.store.toUserId);var e=n.getChatList(n.store.toUserId)[0];S(e.bothOwner,n.store.userName)?e.user1_flag=e.user2_flag:e.user2_flag=e.user1_flag},n.getChatList=function(e){return n.store.message.filter(function(t){return t.bothOwner.includes(e)})},n.rankMark=function(e,t){var r=n.getChatList(t),a=r[0],i=a.bothOwner,s=a.user1_flag,o=a.user2_flag;if("sender"===e){S(i,n.store.userName)?r[0].user1_flag+=1:r[0].user2_flag+=1}else{var c=S(i,t),u=Math.max(s,o)+1;c?r[0].user1_flag=u:r[0].user2_flag=u}},n.getFriendInfo=function(e){return n.store.friendsList.filter(function(t){return t.userName===e})[0]||{}},n.getAvatar=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.store.userName;return e===n.store.userName?n.store.avatar:n.store.friendsList.filter(function(t){return t.userName===e})[0].avatar||""},n.getMyInfoObj=function(){return{userName:n.store.userName,nickName:n.store.nickName,avatar:n.store.avatar}},n}return y()(t,e),p()(t,[{key:"store",get:function(){return this.props.chatStore}}]),t}(c.a.Component),q=A()(D.prototype,"changeInput",[z],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e,t,n){e[t]=n.target.value}}}),B=A()(D.prototype,"initMessage",[T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n,r){var a=function(e,t){return[e,t].sort(function(e,t){return e>t}).join("@")}(t,n),i=S(a,t);runInAction(function(){e.store.message.push({message:[e.createMessage(t,r)],bothOwner:a,user1_flag:i?1:0,user2_flag:i?0:1})})}}}),H=A()(D.prototype,"changePage",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.store.pageKey=t}}}),D),G=(n(56),n(31)),Q=n.n(G),Y=(n(123),n(26)),X=n.n(Y),Z=(n(57),n(22)),$=n.n(Z);n(322),n(323);var ee,te,ne,re=function(){return c.a.createElement("div",{className:"loadEffect"},new Array(8).fill("").map(function(e,t){return c.a.createElement("span",{key:t})}))},ae=n(143),ie=n.n(ae),se=Object(k.b)("chatStore")((ne=te=function(e){function t(){return f()(this,t),g()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:ie.a.topBar,style:{justifyContent:this.props.noBack?"space-around":"space-between"}},!this.props.noBack&&c.a.createElement("div",{className:ie.a.back,onClick:this.props.back},"<"),c.a.createElement("div",{onClick:function(){console.log(Object(C.l)(e.props.chatStore))}},this.props.midContent),this.props.children||!this.props.noBack&&c.a.createElement("div",null,"    "))}}]),t}(c.a.PureComponent),te.defaultProps={noBack:!1,back:function(){},midContent:""},ee=ne))||ee,oe=n(65),ce=n.n(oe);var ue,le,me,fe,de,pe,he,ge,be,ve,we,ye,ke,Ne,Ee,Ie,xe,Oe,je=function(e){var t=e.info,n=t.userName,r=t.nickName,a=t.avatar;return c.a.createElement("div",{className:ce.a.meavatarbar},c.a.createElement("div",{className:ce.a.meavatar,style:{backgroundImage:U(a)}}),c.a.createElement("div",{className:ce.a.wrapper},c.a.createElement("div",{className:ce.a.nickname},r),c.a.createElement("div",{className:ce.a.uid},"chatID: ",n)))},Ce="FRIENDS",_e="ADD",Pe="ME",Le={0:Ce,1:_e,2:Pe,3:"CHAT",4:"FRIENDINFO"},Ae=$.a.TextArea,Me=Object(k.b)("chatStore")(ue=Object(k.c)((le=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).messageList=n.getChatList(n.store.toUserId),P()(n,"scrollLock",me,x()(n)),n.componentDidMount=s()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n.updateMesRank(),n.box=document.getElementsByClassName("chat-box")[0],n.boxScroll(),Object(C.d)(function(){var e;((null===(e=n.messageList[0])||void 0===e?void 0:e.message)||[]).length>0&&setTimeout(n.boxScroll,0)}),new IntersectionObserver(function(){var e=s()(a.a.mark(function e(t){var r,i,s,o,c,u,l;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t[0].intersectionRatio<=0)){e.next=2;break}return e.abrupt("return");case 2:if(r=n.messageList[0]||"",i=15,!(r&&r.message.length>0)){e.next=12;break}if(s=r.user1_flag,o=r.user2_flag,c=r.message,!((u=Math.max(s,o)-c.length)<=0)){e.next=9;break}return e.abrupt("return");case 9:i=u>15?15:u,e.next=13;break;case 12:return e.abrupt("return");case 13:return n.scrollLock=!0,e.next=16,V.get("getMoreMessage",{currentLength:n.messageList[0].message.length,toFriend:n.store.toUserId,length:i},{});case 16:l=e.sent,Object(C.j)(function(){n.messageList[0].message=l.message.concat(Object(C.l)(n.messageList[0].message))}),setTimeout(function(){n.scrollLock=!1},0);case 19:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()).observe(document.getElementById("chat-mess-observer"));case 6:case"end":return e.stop()}},e)})),n.boxScroll=function(){!n.scrollLock&&n.box.scrollTo(0,n.box.scrollHeight)},n.handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(){var e=s()(a.a.mark(function e(t,r){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.message){e.next=2;break}return e.abrupt("return");case 2:n.messageList.length>0?Object(C.j)(function(){n.messageList[0].message.push(n.createMessage(n.store.userName,r.message))}):n.initMessage(n.store.userID,n.store.toUserId,r.message),n.rankMark("sender",n.store.toUserId),n.store.socketIoObj.emit("chat message",n.store.toUserId,n.store.userName,r.message),n.props.form.resetFields();case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())},n.getMessage=function(){var e=n.messageList,t=(e=e.length>0?e[0].message:[]).reverse().map(function(e,t){var r=n.store.userName===e.owner,a=c.a.createElement("div",{className:"user-avatar",style:{backgroundImage:U(n.getAvatar(e.owner))}}),i=c.a.createElement("div",{className:"user-say"},e.content);return c.a.createElement("div",{key:t,className:"word-box "+(r?"right-box":"left-box")},r?i:a,r?a:i)});return t.push(c.a.createElement("div",{key:"0_0",id:"chat-mess-observer"},n.scrollLock?re():"1")),t},n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return c.a.createElement("div",null,c.a.createElement(se,{midContent:this.getFriendInfo(this.store.toUserId).nickName||this.store.toUserId,back:this.changePage.bind(this,Ce)},c.a.createElement("div",{className:"chat-top-more",onClick:this.changePage.bind(this,"FRIENDINFO")},". . .")),c.a.createElement("div",{className:"chat-box-wrapper"},c.a.createElement("div",{className:"chat-box"},this.getMessage())),c.a.createElement(X.a,{onSubmit:this.handleSubmit,className:"chat-form"},c.a.createElement(X.a.Item,{className:"chat-text-input"},e("message",{rules:[{required:!0,message:"empty message!"}],initialValue:""})(c.a.createElement(Ae,{className:"chat-text",autosize:{minRows:1,maxRows:6},placeholder:"put something in!"}))),c.a.createElement(Q.a,{type:"primary",htmlType:"submit",className:"chat-send"},"Send")))}}]),t}(K),me=A()(le.prototype,"scrollLock",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ue=le))||ue)||ue,Fe=X.a.create({name:"normal_login"})(Me),Se=(n(454),$.a.Search),Re=Object(k.b)("chatStore")(fe=Object(k.c)((de=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i))),P()(n,"removeItemFromArray",pe,x()(n)),n.searchName=function(){var e=s()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if(t!==n.store.userName){e.next=5;break}return E.a.error("不能添加自己"),e.abrupt("return");case 5:return e.next=7,V.get("searchName",{searchName:t},{});case 7:r=e.sent,Object(C.j)(function(){n.store.searchList="not found"===r?[]:r});case 9:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.addFriend=function(){var e=s()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.get("addFriend",{friendName:t},{});case 2:"friend request success!"===(r=e.sent)?(E.a.success("请求发送成功"),n.store.socketIoObj.emit("informFriend",{type:"addReq",friendName:t,IAm:n.store.userName})):"A friend request has been sent"===r&&E.a.error("好友请求已发送，请勿重复发送");case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.getList=function(e){var t="search"===e;return(t?n.store.searchList:n.store.friendRequest).map(function(e,r){var a=W(n.store.friendsList,e)&&W(e.friendsList,{userName:n.store.userName}),i=t?a?"Added":"Add":"Agree";return c.a.createElement("div",{className:"search-person",key:r},c.a.createElement(Q.a,{type:"primary",disabled:!!t&&a,className:"add-button",onClick:t?n.addFriend.bind(x()(n),e.userName):n.agree.bind(x()(n),e)},i),!t&&c.a.createElement(Q.a,{type:"dashed",onClick:function(){return n.ignore(e.userName)},className:"delete-friReq"},"Ignore"),c.a.createElement(je,{info:e}))})},n.ignore=function(){var e=s()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.post("updateUserInfo",{changeObj:{delete:{value:t,key:"friendRequest"}}},{});case 2:e.sent,Object(C.j)(function(){var e=n.store.friendRequest.findIndex(function(e){return e.userName===t});n.store.friendRequest.splice(e,1)});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.agree=function(){var e=s()(a.a.mark(function e(t){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.userName,e.next=3,V.get("agreeFriendReq",{friendName:r},{});case 3:"have a new friend!"===e.sent&&(E.a.success("已添加好友"),n.store.socketIoObj.emit("informFriend",{type:"agreeReq",friendName:r,IAm:n.store.userName}),Object(C.j)(function(){W(n.store.friendsList,t)||n.store.friendsList.push(t)}),n.removeItemFromArray(n.store.friendRequest,r));case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.getReqList=function(){return n.store.friendRequest.map(function(e,t){return c.a.createElement("div",{key:t,className:"search-person"},c.a.createElement("div",null,e),c.a.createElement(Q.a,{type:"primary",onClick:n.agree.bind(x()(n),e)},"I agree!"))})},n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:"add-container"},c.a.createElement(se,{noBack:!0,midContent:"Contats"}),c.a.createElement(Se,{placeholder:"search chatID to add new friend!",style:{marginTop:".1rem"},onSearch:function(t){e.searchName(t)},enterButton:!0}),c.a.createElement("div",{className:"search-list"},this.getList("search")),c.a.createElement("div",{className:"search-list"},this.getList("addReq")))}}]),t}(K),pe=A()(de.prototype,"removeItemFromArray",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e,t){var n=e.findIndex(function(e){return e.userName===t});-1!==n&&e.splice(n,1)}}}),fe=de))||fe)||fe,Ue=n(32),ze=n.n(Ue),Te=Object(o.lazy)(function(){return new Promise(function(e){n.e(3).then(function(t){e(n(572))}.bind(null,n)).catch(n.oe)})}),De=function(e){return c.a.createElement(o.Suspense,{fallback:re()},c.a.createElement(Te,e))},qe=Object(k.b)("chatStore")(he=Object(k.c)((ge=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).state={status:"profile"},P()(n,"newNickname",be,x()(n)),P()(n,"oldPass",ve,x()(n)),P()(n,"newPass",we,x()(n)),P()(n,"newPassAgain",ye,x()(n)),P()(n,"base64Img",ke,x()(n)),n.clickChange=function(e){n.setState({status:e})},P()(n,"changeTransmisValue",Ne,x()(n)),n.changeNickname=function(){return c.a.createElement($.a,{defaultValue:n.store.nickName,onChange:n.changeTransmisValue.bind(x()(n),"newNickname"),style:{marginTop:".2rem"}})},P()(n,"updateImg",Ee,x()(n)),n.changePassword=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement($.a.Password,{addonBefore:c.a.createElement("span",{className:ze.a.spanAdd},"original password"),onChange:n.changeInput.bind(x()(n),x()(n),"oldPass"),placeholder:"Enter old password",style:{marginTop:".2rem"}}),c.a.createElement($.a.Password,{addonBefore:c.a.createElement("span",{className:ze.a.spanAdd},"new password"),placeholder:"Enter new password",onChange:n.changeInput.bind(x()(n),x()(n),"newPass")}),c.a.createElement($.a.Password,{addonBefore:c.a.createElement("span",{className:ze.a.spanAdd},"confirm password"),placeholder:"Enter new password again",onChange:n.changeInput.bind(x()(n),x()(n),"newPassAgain")}))},n.save=function(){var e=s()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.changeMap[t].isHighLight()){e.next=2;break}return e.abrupt("return");case 2:if("Password"!==t){e.next=14;break}if(n.newPass===n.newPassAgain){e.next=8;break}return E.a.error("两次新密码输入不一致"),e.abrupt("return");case 8:return e.next=10,V.post("chatVerify",{userName:n.store.userName,passWord:n.oldPass},{});case 10:if(e.t0=e.sent,"verified"===e.t0){e.next=14;break}return E.a.error("原密码输入错误"),e.abrupt("return");case 14:return e.next=16,V.post("updateUserInfo",{changeObj:n.changeMap[t].transferObj()},{});case 16:"success"===e.sent&&(E.a.success("保存成功"),Object(C.j)(function(){n.changeMap[t].postCB()}));case 18:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),n.changeMap={Nickname:{render:n.changeNickname,isHighLight:function(){return n.newNickname!==n.store.nickName},transferObj:function(){return{nickName:n.newNickname}},postCB:function(){n.store.nickName=n.newNickname}},Avatar:{render:function(){return c.a.createElement(De,{updateIMg:n.updateImg})},isHighLight:function(){return""!==n.base64Img},transferObj:function(){return{avatar:n.base64Img}},postCB:function(){n.store.avatar=n.base64Img}},Password:{render:n.changePassword,isHighLight:function(){return n.oldPass&&n.newPass&&n.newPassAgain},transferObj:function(){return{passWord:n.newPass}},postCB:function(){}}},n.logOut=function(){Object(M.writeCookie)({password:""},10),window.location.href="/login.html"},n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this;return c.a.createElement("div",{className:ze.a.mewrapper},"profile"===this.state.status?c.a.createElement(c.a.Fragment,null,c.a.createElement(se,{noBack:!0,midContent:"Me"}),c.a.createElement(je,{info:this.getMyInfoObj()}),["Nickname","Avatar","Password"].map(function(t,n){return c.a.createElement("div",{key:n,className:J(ze.a.changeItem,ze.a["ch"+t]),onClick:e.clickChange.bind(e,t)},t)}),c.a.createElement("div",{className:J(ze.a.changeItem,ze.a.logOut),onClick:this.logOut},"Log Out")):c.a.createElement("div",{className:ze.a.edit},c.a.createElement(se,{back:this.clickChange.bind(this,"profile"),midContent:this.state.status},c.a.createElement("div",{onClick:this.save.bind(this,this.state.status),className:J(ze.a.save,this.changeMap[this.state.status].isHighLight()?ze.a.saveHighlight:"")},"save")),this.changeMap[this.state.status].render()))}}]),t}(K),be=A()(ge.prototype,"newNickname",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return this.store.nickName}}),ve=A()(ge.prototype,"oldPass",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),we=A()(ge.prototype,"newPass",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ye=A()(ge.prototype,"newPassAgain",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ke=A()(ge.prototype,"base64Img",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ne=A()(ge.prototype,"changeTransmisValue",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e[t]=n.target.value}}}),Ee=A()(ge.prototype,"updateImg",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.base64Img=t}}}),he=ge))||he)||he,Be=(n(455),Object(k.b)("chatStore")(Ie=Object(k.c)((xe=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return n=g()(this,(e=v()(t)).call.apply(e,[this].concat(a))),P()(n,"entryTalk",Oe,x()(n)),n.getFriend=function(){var e=0,t=n.store.friendsList.map(function(t,r){var a=n.store.message.filter(function(e){return e.bothOwner.includes(t.userName)}),i="",s=0;if(a.length>0){var o=a[0].message,u=a[0],l=u.bothOwner,m=u.user1_flag,f=u.user2_flag;s=(s=S(l,n.store.userName)?f-m:m-f)>99?"99+":s,i=o[o.length-1].content,e+=s}return c.a.createElement("div",{className:"friend-item",key:r,onClick:n.entryTalk.bind(x()(n),t.userName)},c.a.createElement("div",{className:"friend-icon",style:{backgroundImage:U(n.getAvatar(t.userName))}},s>0&&c.a.createElement("div",{className:"friend-mes-info"},s)),c.a.createElement("div",{className:"friend-content"},c.a.createElement("div",{className:"friend-name"},t.nickName),c.a.createElement("div",{className:"fri-say"},i)))});return Object(C.j)(function(){n.store.allPopUp=e}),t},n}return y()(t,e),p()(t,[{key:"render",value:function(){return c.a.createElement("div",{className:"friendList-wrapper"},c.a.createElement(se,{noBack:!0,midContent:"IChat"}),c.a.createElement("div",{className:"fri-list-name"},"好友列表"),c.a.createElement("div",null,this.getFriend()))}}]),t}(K),Oe=A()(xe.prototype,"entryTalk",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){e.store.pageKey="CHAT",e.store.toUserId=t}}}),Ie=xe))||Ie)||Ie);function He(){!function(e){window.WebViewJavascriptBridge?e(WebViewJavascriptBridge):document.addEventListener("WebViewJavascriptBridgeReady",function(){e(WebViewJavascriptBridge)},!1)}(function(e){e.init(function(e,t){console.log("JS got a message",e);var n={"Javascript Responds":"测试中文!"};t&&(console.log("JS responding with",n),t(n))}),e.registerHandler("functionInJs",function(e,t){})})}n(456);var Ve,We,Je,Ke,Ge,Qe,Ye,Xe,Ze,$e,et,tt,nt,rt,at,it,st,ot,ct,ut,lt,mt,ft,dt,pt=n(211),ht=n.n(pt),gt=n(66),bt=n.n(gt),vt=Object(k.b)("chatStore")(Ve=Object(k.c)((We=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i))),P()(n,"status",Je,x()(n)),P()(n,"newFriendNickName",Ke,x()(n)),P()(n,"showDialog",Ge,x()(n)),P()(n,"clickChange",Qe,x()(n)),P()(n,"changeTransmisValue",Ye,x()(n)),n.save=s()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n.isHighLight()){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,V.post("updateUserInfo",{changeObj:{fridendNickName:{newNickName:n.newFriendNickName,friend:n.store.toUserId}}},{});case 4:"success"===e.sent&&(E.a.success("保存成功"),Object(C.j)(function(){n.store.friendsList.filter(function(e){return e.userName===n.store.toUserId})[0].nickName=n.newFriendNickName}));case 6:case"end":return e.stop()}},e)})),n.isHighLight=function(){return n.newFriendNickName!==n.getFriendInfo(n.store.toUserId).nickName},n.handleOk=s()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.post("updateUserInfo",{changeObj:{delete:{key:"friendsList",value:n.store.toUserId}}},{});case 2:Object(C.j)(function(){var e=n.store.friendsList.findIndex(function(e){return e.userName===n.store.toUserId});n.store.friendsList.splice(e,1)}),n.handleCancel(),n.changePage(Ce);case 5:case"end":return e.stop()}},e)})),P()(n,"handleCancel",Xe,x()(n)),n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this,t=this.getFriendInfo(this.store.toUserId),n=(t.avatar,t.nickName);t.userName;return c.a.createElement("div",{className:bt.a.mewrapper},"profile"===this.status?c.a.createElement(c.a.Fragment,null,c.a.createElement(se,{midContent:"profile",back:this.changePage.bind(this,"CHAT")}),c.a.createElement(je,{info:t}),["Set remark","Delete friend"].map(function(t,n){return c.a.createElement("div",{key:n,className:J(bt.a.changeItem,"Delete friend"===t?bt.a.last:""),onClick:e.clickChange.bind(e,t)},t)}),c.a.createElement(ht.a,{title:"Pay Attention!",visible:this.showDialog,onOk:this.handleOk,onCancel:this.handleCancel},c.a.createElement("p",null,"Are you Sure to Delete a Friend(".concat(n,")?")))):c.a.createElement("div",null,c.a.createElement(se,{back:this.clickChange.bind(this,"profile"),midContent:this.status},c.a.createElement("div",{onClick:this.save,className:J(bt.a.save,this.isHighLight()?bt.a.saveHighlight:"")},"save")),c.a.createElement($.a,{defaultValue:this.getFriendInfo(this.store.toUserId).nickName,onChange:this.changeTransmisValue.bind(this,"newFriendNickName"),style:{marginTop:".2rem"}})))}}]),t}(K),Je=A()(We.prototype,"status",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"profile"}}),Ke=A()(We.prototype,"newFriendNickName",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ge=A()(We.prototype,"showDialog",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Qe=A()(We.prototype,"clickChange",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){"Delete friend"===t?e.showDialog=!0:e.status=t}}}),Ye=A()(We.prototype,"changeTransmisValue",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t,n){e[t]=n.target.value}}}),Xe=A()(We.prototype,"handleCancel",[C.c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.showDialog=!1}}}),Ve=We))||Ve)||Ve,wt=Object(k.b)("chatStore")(Ze=Object(k.c)(Ze=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=g()(this,(e=v()(t)).call.apply(e,[this].concat(a)))).getTab=function(){return c.a.createElement("div",{className:"bottom-tab"},["friends","contats","me"].map(function(e,t){var r="contats"===e&&n.store.friendRequest.length>0;return c.a.createElement("div",{className:"bottom-item"+(n.store.pageKey===Le[t]?" item-focus":"")+(r?" new-friend-req":""),key:t,onClick:n.changePage.bind(x()(n),Le[t])},e)}))},n}return y()(t,e),p()(t,[{key:"componentDidMount",value:function(){var e=this;He(),Object(C.d)(function(){!function(e){window.WebViewJavascriptBridge&&window.WebViewJavascriptBridge.callHandler("submitFromWeb",e,function(e){})}(e.store.allPopUp)}),window.chatUserName=this.store.userName;var t=window.location.protocol;Object(C.j)(function(){var n=t+"//tangshisanbaishou.xyz";e.store.socketIoObj=j()(n,{path:"/mySocket"})}),this.store.socketIoObj.on("chat message",function(t){var n=t.owner,r=t.message;Object(C.j)(function(){var t=e.getChatList(n);t.length>0?t[0].message.push(e.createMessage(n,r)):e.initMessage(n,e.store.userName,r)}),"CHAT"===e.store.pageKey?e.updateMesRank():e.rankMark("reveiver",t.owner)}),this.store.socketIoObj.on("system notification",function(t){var n=t.type,r=t.message;({NOT_YOUR_FRIEND:function(){return E.a.error("对方开启好友验证，本消息无法送达")},NEW_FRIEND_REQ:function(){return Object(C.j)(function(){e.store.friendRequest.push(r)})},REQ_AGREE:function(){W(e.store.friendsList,r)||Object(C.j)(function(){e.store.friendsList.push(r)})}})[n]()}),this.store.socketIoObj.emit("register",this.store.userName)}},{key:"render",value:function(){var e={FRIENDS:c.a.createElement(Be,null),ADD:c.a.createElement(Re,null),ME:c.a.createElement(qe,null),CHAT:c.a.createElement(Fe,null),FRIENDINFO:c.a.createElement(vt,null)};return c.a.createElement("div",{className:"main-container"},e[this.store.pageKey],[Ce,_e,Pe].includes(this.store.pageKey)&&this.getTab())}}]),t}(K))||Ze)||Ze,yt=(n(148),n(23)),kt=n.n(yt),Nt=(n(464),X.a.Item,Object(k.c)($e=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(){var e=s()(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=5;break}return e.next=3,M.netModel.post(F.get("chatVerify"),{userName:n.userName,passWord:n.password},{});case 3:"verified"===e.sent?(Object(M.writeCookie)(n,10),window.location.href="/home.html"):E.a.error("账号密码错误");case 5:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())},n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t=Object(M.parseCookie)(),n=t.userName,r=t.password;return c.a.createElement(X.a,{onSubmit:this.handleSubmit,className:"login-form"},c.a.createElement(X.a.Item,null,e("userName",{rules:[{required:!0,message:"Please input your username!"}],initialValue:n})(c.a.createElement($.a,{prefix:c.a.createElement(kt.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),c.a.createElement(X.a.Item,null,e("password",{rules:[{required:!0,message:"Please input your Password!"}],initialValue:r})(c.a.createElement($.a,{prefix:c.a.createElement(kt.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),c.a.createElement("a",{className:"login-register",href:"/register.html"},"register new account"),c.a.createElement(Q.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Log in"))}}]),t}(c.a.Component))||$e),Et=X.a.create({name:"normal_login"})(Nt),It=(n(465),X.a.Item,Object(k.c)(et=function(e){function t(){var e,n;f()(this,t);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return(n=g()(this,(e=v()(t)).call.apply(e,[this].concat(i)))).handleSubmit=function(e){e.preventDefault(),n.props.form.validateFields(function(){var e=s()(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=8;break}if(n.password===n.repassword){e.next=4;break}return E.a.error("两次密码输入不一致"),e.abrupt("return");case 4:return e.next=6,M.netModel.post(F.get("addChatUser"),{userName:n.userName,passWord:n.password},{});case 6:"add user success!"===e.sent?(Object(M.writeCookie)(n,30),window.location.href="/home.html"):E.a.error("用户名已被占用");case 8:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}())},n}return y()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return c.a.createElement(X.a,{onSubmit:this.handleSubmit,className:"login-form"},c.a.createElement(X.a.Item,null,e("userName",{rules:[{required:!0,message:"Please input your username!"}]})(c.a.createElement($.a,{prefix:c.a.createElement(kt.a,{type:"user",style:{color:"rgba(0,0,0,.25)"}}),placeholder:"Username"}))),c.a.createElement(X.a.Item,null,e("password",{rules:[{required:!0,message:"Please input your Password!"}]})(c.a.createElement($.a,{prefix:c.a.createElement(kt.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"Password"}))),c.a.createElement(X.a.Item,null,e("repassword",{rules:[{required:!0,message:"Please input your Password again !"}]})(c.a.createElement($.a,{prefix:c.a.createElement(kt.a,{type:"lock",style:{color:"rgba(0,0,0,.25)"}}),type:"password",placeholder:"rePassword"}))),c.a.createElement(Q.a,{type:"primary",htmlType:"submit",className:"login-form-button"},"Register"))}}]),t}(c.a.Component))||et),xt=X.a.create({name:"normal_login"})(It),Ot=n(212),jt=n(52),Ct=(tt=function e(t){f()(this,e),P()(this,"message",nt,this),P()(this,"userName",rt,this),P()(this,"toUserId",at,this),P()(this,"pageKey",it,this),P()(this,"searchList",st,this),P()(this,"nickName",ot,this),P()(this,"avatar",ct,this),P()(this,"friendsList",ut,this),P()(this,"friendRequest",lt,this),P()(this,"socketIoObj",mt,this),P()(this,"allPopUp",ft,this),this.message=(null===t||void 0===t?void 0:t.message)||[],this.userName=(null===t||void 0===t?void 0:t.userName)||"",this.nickName=(null===t||void 0===t?void 0:t.nickName)||"",this.avatar=(null===t||void 0===t?void 0:t.avatar)||"",this.friendsList=(null===t||void 0===t?void 0:t.friendsList)||[],this.friendRequest=(null===t||void 0===t?void 0:t.friendRequest)||[],this.message=(null===t||void 0===t?void 0:t.message)||[]},nt=A()(tt.prototype,"message",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rt=A()(tt.prototype,"userName",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"1"}}),at=A()(tt.prototype,"toUserId",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"2"}}),it=A()(tt.prototype,"pageKey",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ce}}),st=A()(tt.prototype,"searchList",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ot=A()(tt.prototype,"nickName",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ct=A()(tt.prototype,"avatar",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),ut=A()(tt.prototype,"friendsList",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lt=A()(tt.prototype,"friendRequest",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mt=A()(tt.prototype,"socketIoObj",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),ft=A()(tt.prototype,"allPopUp",[C.i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tt),_t=Object(k.c)(dt=function(e){function t(){return f()(this,t),g()(this,v()(t).apply(this,arguments))}return y()(t,e),p()(t,[{key:"render",value:function(){var e=new Ct(this.props.userInfo);return c.a.createElement(k.a,{chatStore:e},c.a.createElement(Ot.a,null,c.a.createElement(jt.a,{path:"/login.html",component:Et}),c.a.createElement(jt.a,{path:"/register.html",component:xt}),c.a.createElement(jt.a,{path:"/home.html",component:wt})))}}]),t}(c.a.Component))||dt,Pt=Object(M.parseCookie)(),Lt=Pt.userName,At=Pt.password,Mt=function(){var e=s()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M.netModel.post(F.get("chatVerify"),{userName:Lt,passWord:At},{});case 2:"verified"!==e.sent&&"home"===t&&(window.location.href="/login.html");case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();(function(){var e=s()(a.a.mark(function e(){var t,n,r,i,s;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=document.getElementById("main"),n=/.*(?=\.html)/.exec(window.location.pathname)[0],r=R(n,"/"),Mt(r),e.next=7,M.netModel.get(F.get("userInfo"),{userName:Lt},{});case 7:if(i=e.sent,"home"!==r){e.next=13;break}return e.next=11,M.netModel.get(F.get("getAllMessage"),{userName:Lt},{});case 11:s=e.sent,i.message=s;case 13:l.a.render(c.a.createElement(_t,{userInfo:i}),t);case 14:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()()},65:function(e,t,n){e.exports={meavatarbar:"index__meavatarbar--3e864",meavatar:"index__meavatar--hlpth",nickname:"index__nickname--1Dyy4",uid:"index__uid--2zIzM",wrapper:"index__wrapper--1lUpe"}},66:function(e,t,n){e.exports={mewrapper:"index__mewrapper--2LyFk",changeItem:"index__changeItem--16rHI",last:"index__last--8mSUY",save:"index__save--1cNhz",saveHighlight:"index__saveHighlight--ueP-2"}}});</script></body>
<!-- <script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script> -->
<!-- <script src="http://wechatfe.github.io/vconsole/lib/vconsole.min.js?v=3.2.0"></script>
<script>
  // init vConsole
  var vConsole = new VConsole();
  console.log('Hello world');
</script> -->
</html>